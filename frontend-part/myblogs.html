<!DOCTYPE html>
<html>
<head>
    <title>My Blogs - Dashboard</title>
    <link rel="stylesheet" href="myblogs.css"> 
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"> 
</head>
<body>

    <button id="theme-toggle" class="theme-toggle"><i class="fas fa-sun"></i></button>

    <div class="page-wrapper">
        <div class="dashboard-header">
            <h2 class="dashboard-title">My Posts üìù</h2>
            <div class="header-controls">
            <a href="add.html" class="action-btn primary-btn"><i class="fas fa-pencil-alt"></i> Create New Post</a>
            <a href="blog.html" class="action-btn secondary-btn"><i class="fas fa-globe"></i> View Public Feed</a>
        </div>
        </div>
        
        <div class="category-bar-wrapper">
            <div class="category-bar">
                <a href="#" class="category-link active">All Posts</a>
                <a href="#" class="category-link">Technology</a>
                <a href="#" class="category-link">Tutorials</a>
                <a href="#" class="category-link">Motivation</a>
                <a href="#" class="category-link">Career</a>
                <a href="#" class="category-link">Latest</a>
            </div>
        </div>

        <div class="filter-controls">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="blog-search" placeholder="Search by title..." />
            </div>
            <select id="category-filter" class="filter-select">
                <option value="all">All Categories</option>
                <option value="tech">Technology</option>
                <option value="motivation">Motivation</option>
            </select>
            <select id="sort-order" class="filter-select">
                <option value="latest">Sort: Latest</option>
                <option value="oldest">Sort: Oldest</option>
            </select>
        </div>
        
        <hr class="divider"/>

        <div id="blogs-grid">
            <div class="skeleton-card"></div>
            <div class="skeleton-card"></div>
            <div class="skeleton-card"></div>
            <div class="skeleton-card"></div>
            <div class="skeleton-card"></div>
            <div class="skeleton-card"></div>
        </div>
        
        <div id="pagination-footer" class="pagination-footer">
            <button class="pagination-btn disabled">Previous</button>
            <span class="page-number active">1</span>
            <span class="page-number">2</span>
            <span class="page-number">3</span>
            <button class="pagination-btn">Next</button>
        </div>
    </div>
    
    <script>
        const container = document.getElementById('blogs-grid'); 

        const userId = localStorage.getItem("userId");
        if (!userId) {
            alert("You must be logged in to view your blogs.");
            window.location.href = "login.html"; 
        }

        // Delay to allow skeleton to show for demonstration
        setTimeout(() => {
            fetch(`http://localhost:8080/myblogs/${userId}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to fetch user blogs.');
                    }
                    return response.json();
                })
                .then(blogs => {
                    container.innerHTML = ''; // Clear skeleton loader
    
                    if (blogs.length === 0) {
                        container.innerHTML = "<p class='empty-state'>You haven't published any blogs yet. <a href='add.html'>Start writing now!</a></p>";
                        return;
                    }
                    
                    blogs.reverse().forEach(blog => {
                        const card = document.createElement('div');
                        card.className = 'blog-card'; 
                        
                        // 5. Fade-in animation hook
                        card.style.animationDelay = `${Math.random() * 0.5}s`;

                        // 1. IMAGE DISPLAY
                        const img = document.createElement('img');
                        img.src = blog.imageUrl || 'https://via.placeholder.com/400x180?text=No+Image'; 
                        img.alt = "Featured image for " + blog.title;
                        img.className = 'card-image-zoom'; // 5. Zoom animation hook
                        card.appendChild(img);
    
                        const contentWrapper = document.createElement('div');
                        contentWrapper.className = 'card-content-wrapper';
    
                        // 8. METADATA (Author, Date, Views)
                        const meta = document.createElement('div');
                        meta.className = 'blog-metadata';
                        
                        // 3. Category Badge (Placeholder for dynamic data)
                        const category = blog.category || (blog.id % 3 === 0 ? 'Motivation' : blog.id % 3 === 1 ? 'Technology' : 'Tutorials');
                        
                        meta.innerHTML = `
                            <span class="tag tag-${category.toLowerCase()}">${category}</span>
                            <span class="meta-separator">|</span>
                            <span class="author-name"><i class="fas fa-user"></i> ${blog.userName || 'You'}</span>
                            <span class="meta-separator">|</span>
                            <span class="published-date"><i class="fas fa-calendar-alt"></i> ${new Date().toLocaleDateString()}</span>
                            <span class="meta-separator">|</span>
                            <span class="view-count"><i class="fas fa-eye"></i> ${Math.floor(Math.random() * 900) + 100} views</span>
                        `;
                        contentWrapper.appendChild(meta);
                        
                        // 2. TITLE AND LINK 
                        const title = document.createElement('h3'); 
                        const link = document.createElement('a');
                        link.href = 'view.html?id=' + blog.id;
                        link.textContent = blog.title;
                        title.appendChild(link);
                        contentWrapper.appendChild(title);
    
                        // 3. PREVIEW TEXT 
                        const preview = document.createElement('p'); 
                        preview.className = 'blog-description';
                        preview.textContent = blog.content.substring(0, 150) + '...';
                        contentWrapper.appendChild(preview);
                        
                        const readMoreLink = document.createElement('a');
                        readMoreLink.href = 'view.html?id=' + blog.id;
                        readMoreLink.textContent = 'Read More ‚Üí';
                        readMoreLink.className = 'read-more-link';
                        contentWrapper.appendChild(readMoreLink);
                        
                        card.appendChild(contentWrapper);
                        
                        // 4. EDIT AND DELETE CONTROLS
                        const controls = document.createElement('div');
                        controls.className = 'controls-footer'; 
    
                        const editButton = document.createElement('a');
                        editButton.href = `edit.html?id=${blog.id}`; 
                        editButton.textContent = 'Edit Post';
                        editButton.className = 'control-btn edit-btn';
                        controls.appendChild(editButton);
    
                        const deleteButton = document.createElement('button');
                        deleteButton.textContent = 'Delete';
                        deleteButton.className = 'control-btn delete-btn';
                        deleteButton.onclick = () => deleteBlog(blog.id); 
                        controls.appendChild(deleteButton);
    
                        card.appendChild(controls);
                        container.appendChild(card);
                    });
                })
                .catch(error => {
                    console.error('Error fetching blogs:', error);
                    document.getElementById('blogs-grid').innerHTML = "<p class='error-message'>There was an error loading your blog posts. Please check your server connection.</p>";
                });
        }, 1500); // Wait 1.5 seconds to show skeleton
            
        // --- SECURE DELETE FUNCTION (UNCHANGED) ---
        function deleteBlog(blogId) {
            if (!confirm("Are you sure you want to delete this blog? This action cannot be undone.")) { return; }
            const currentUserId = localStorage.getItem("userId");
            fetch(`http://localhost:8080/blog/delete/${blogId}`, {
                method: 'DELETE',
                headers: { 'X-User-Id': currentUserId }
            })
            .then(r => r.text())
            .then(msg => {
                alert(msg);
                if (msg.includes("successfully")) { location.reload(); }
            })
            .catch(err => {
                alert("Deletion failed due to network error.");
                console.error("Deletion failed:", err)
            });
        }
        
        // --- Command 10: Light/Dark Mode Toggle (Basic UI Toggle) ---
        document.getElementById('theme-toggle').addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            const icon = document.querySelector('#theme-toggle i');
            if (document.body.classList.contains('dark-mode')) {
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
            } else {
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
            }
        });
    </script>

</body>
</html>