<!DOCTYPE html>
<html>
<head>
Â  Â  <title>Add Blog</title>
Â  Â  <link rel="stylesheet" href="add.css"> 
Â  Â  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
Â  Â  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>

<div id="page-wrapper">
Â  Â  
Â  Â  <h1 id="page-title">ðŸŒŸ WriteFlow â€“ Create a New Blog</h1> 

Â  Â  <div id="blog-card">
Â  Â  Â  Â  
Â  Â  Â  Â  <h2 class="card-header">Create a New Blog Post</h2>
Â  Â  Â  Â  
Â  Â  Â  Â  <div class="form-grid">
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  <div class="main-content-section">
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  <input id="title" placeholder="Blog Title (Max 80 characters)">
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="content" placeholder="Write your content here..."></textarea>
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  <div class="actions-footer">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="add()" class="publish-btn">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-rocket"></i> Publish Blog
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a href="myblogs.html" class="cancel-link">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-arrow-left"></i> Cancel and Go Back
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="image-upload-section">
Â  Â  Â  Â  Â  Â  Â  Â  <label for="imageFile" class="image-upload-box" id="upload-area">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="upload-box-placeholder">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-cloud-upload-alt"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Click to upload or drag & drop</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="recommended-size">1200 Ã— 800 recommended</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="file" id="imageFile" accept="image/*" style="display: none;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img id="image-preview" src="#" alt="Image Preview" style="display: none;">
Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  <p id="msg" class="validation-msg"></p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>
</div>

<script>
// --- CRITICAL SECURITY CHECK (P2) ---
const userId = localStorage.getItem("userId");
if (!userId) {
    alert("You must be logged in to create a new blog post.");
    window.location.href = "login.html"; 
}
// --- END SECURITY CHECK ---

let base64Image = "";

document.getElementById('imageFile').addEventListener('change', function(e) {
Â  Â  const file = e.target.files[0];
Â  Â  const previewImg = document.getElementById('image-preview');
Â  Â  const placeholder = document.getElementById('upload-box-placeholder');
Â  Â  
Â  Â  if (file) {
Â  Â  Â  Â  document.getElementById("msg").innerText = ""; 
Â  Â  Â  Â  
Â  Â  Â  Â  const reader = new FileReader();
Â  Â  Â  Â  reader.onloadend = function() {
Â  Â  Â  Â  Â  Â  base64Image = reader.result;
Â  Â  Â  Â  Â  Â  previewImg.src = base64Image;
Â  Â  Â  Â  Â  Â  previewImg.style.display = 'block';
Â  Â  Â  Â  Â  Â  placeholder.style.display = 'none'; 
Â  Â  Â  Â  Â  Â  console.log("Image successfully converted to Base64.");
Â  Â  Â  Â  }
Â  Â  Â  Â  reader.readAsDataURL(file); 
Â  Â  } else {
Â  Â  Â  Â  base64Image = "";
Â  Â  Â  Â  previewImg.style.display = 'none';
Â  Â  Â  Â  placeholder.style.display = 'flex';
Â  Â  }
});

function add(){
Â  Â  if (base64Image === "") {
Â  Â  Â  Â  document.getElementById("msg").innerText = "Please upload a featured image.";
Â  Â  Â  Â  document.getElementById("msg").style.color = "var(--danger-color)";
Â  Â  Â  Â  return;
Â  Â  }
Â  Â  
Â  Â  fetch("http://localhost:8080/blog/add",{
Â  Â  Â  Â  method:"POST",
Â  Â  Â  Â  headers:{"Content-Type":"application/json"},
Â  Â  Â  Â  body:JSON.stringify({
Â  Â  Â  Â  Â  Â  title:title.value,
Â  Â  Â  Â  Â  Â  imageUrl: base64Image,
Â  Â  Â  Â  Â  Â  content:content.value,
Â  Â  Â  Â  Â  Â  userId:localStorage.getItem("userId"),
Â  Â  Â  Â  Â  Â  username:localStorage.getItem("username")
Â  Â  Â  Â  })
Â  Â  })
Â  Â  .then(r=>r.text())
Â  Â  .then(msg=>{
Â  Â  Â  Â  if (msg.toLowerCase().includes("success")) {
Â  Â  Â  Â  Â  Â  Â document.getElementById("msg").style.color = "var(--primary-color)";
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â document.getElementById("msg").style.color = "var(--danger-color)";
Â  Â  Â  Â  }
Â  Â  Â  Â  document.getElementById("msg").innerText=msg;
Â  Â  Â  Â  
Â  Â  Â  Â  if (msg.toLowerCase().includes("success")) {
Â  Â  Â  Â  Â  Â  setTimeout(()=>location.href="myblogs.html",1000);
Â  Â  Â  Â  }
Â  Â  });
}
</script>

</body>
</html>